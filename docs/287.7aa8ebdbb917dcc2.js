"use strict";(self.webpackChunkangular_firebase=self.webpackChunkangular_firebase||[]).push([[287],{7287:(Q,C,a)=>{a.r(C),a.d(C,{PhotoModule:()=>l});var v=a(6895),u=a(4859),f=a(7009),r=a(5938),D=a(2687),x=a(3657),y=a(3336),e=a(4650);class c{}c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({imports:[v.ez,D.rt,r.Is,u.ot,y.Ps,x.q]});var P=a(6159),_=a(5861),M=a(5963),b=a(8996),R=a(8746),T=a(3079),E=a(793),S=a(7386);class h{constructor(t,n){this.element=t,this.renderer=n,this.isLoaded=!1}ngOnChanges(){this.isLoaded&&this.setStyle()}setStyle(){this.videoRef&&(this.renderer.setProperty(this.element.nativeElement,"height",this.videoRef.height),this.renderer.setProperty(this.element.nativeElement,"width",this.videoRef.width))}}h.\u0275fac=function(t){return new(t||h)(e.Y36(e.SBq),e.Y36(e.Qsj))},h.\u0275dir=e.lG2({type:h,selectors:[["","appDimensionCanvas",""]],inputs:{videoRef:["appDimensionCanvas","videoRef"],isLoaded:"isLoaded"},features:[e.TTD]});class m{constructor(t,n){this.element=t,this.renderer=n,this.isLoaded=!1}ngOnChanges(){this.isLoaded&&this.setStyle()}setStyle(){this.isLoaded&&(this.renderer.setAttribute(this.element.nativeElement,"height",this.element.nativeElement.clientHeight),this.renderer.setAttribute(this.element.nativeElement,"width",this.element.nativeElement.clientWidth),this.renderer.setStyle(this.element.nativeElement,"height","100vh"),this.renderer.setStyle(this.element.nativeElement,"width","100vw"),this.renderer.setStyle(this.element.nativeElement,"max-height","100vh"),this.renderer.setStyle(this.element.nativeElement,"max-width","100vw"),this.renderer.setStyle(this.element.nativeElement,"position","absolute"),this.renderer.setStyle(this.element.nativeElement,"object-fit"," cover"),this.renderer.setStyle(this.element.nativeElement,"background","#273244"))}}m.\u0275fac=function(t){return new(t||m)(e.Y36(e.SBq),e.Y36(e.Qsj))},m.\u0275dir=e.lG2({type:m,selectors:[["","appDimensionVideo",""]],inputs:{isLoaded:["appDimensionVideo","isLoaded"]},features:[e.TTD]});const w=["video"],I=["canvas"],O=["img"];function L(o,t){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.load())}),e._uU(2,"Start"),e.qZA(),e.BQk()}}function Z(o,t){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"button",10),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.stop())}),e._uU(2,"stop"),e.qZA(),e.BQk()}}function k(o,t){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"button",11),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.changeCamera())}),e._uU(2,"change Camera"),e.qZA(),e.BQk()}}function B(o,t){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"button",12),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.capture())}),e.TgZ(2,"mat-icon"),e._uU(3,"camera"),e.qZA(),e._uU(4," take "),e.qZA(),e.BQk()}}function A(o,t){if(1&o){const n=e.EpF();e.ynx(0),e.TgZ(1,"button",12),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.unCapture())}),e._uU(2,"remove picture"),e.qZA(),e.BQk()}}class g{constructor(t,n){this.snackBar=t,this.loaderService=n,this.videoRef=new e.SBq({}),this.canvasRef=new e.SBq({}),this.imgRef=new e.SBq({}),this.deviceIdList=[],this.deviceIdIndex=1,this.hasPhoto=!1,this.isLoaded=!1}ngOnInit(){}ngAfterViewInit(){(0,M.H)(0).subscribe(()=>this.load())}ngOnDestroy(){this.stop()}get mediaStream(){return this.videoRef.nativeElement.srcObject}setMediaStreamAndPlay(t){this.videoRef.nativeElement.srcObject=t,this.videoRef.nativeElement.play().then(()=>this.isLoaded=!0)}load(t){var n=this;return(0,_.Z)(function*(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(n.deviceIdList=yield navigator.mediaDevices.enumerateDevices().then(i=>i.filter(s=>"videoinput"===s.kind).map(s=>s.deviceId)),(0,b.D)(navigator.mediaDevices.getUserMedia(t||{video:!0})).pipe((0,T.j)(()=>n.loaderService.start()),(0,R.x)(()=>n.loaderService.stop())).subscribe(i=>n.setMediaStreamAndPlay(i),i=>{String(i).toLowerCase().includes("permission")&&n.snackBar.open("camera permission denied","",{duration:2e3}),console.error("ERROR => ",i)})):n.snackBar.open("c\xe2mera n\xe3o encontrada","",{duration:2e3})})()}stop(){this.mediaStream&&(this.videoRef.nativeElement.pause(),this.mediaStream.getVideoTracks().forEach(t=>t.stop()),this.videoRef.nativeElement.srcObject=null,this.isLoaded=!1)}changeCamera(){if(this.deviceIdList.length<=this.deviceIdIndex)return this.deviceIdIndex=0,void this.changeCamera();const t={video:{deviceId:this.deviceIdList[this.deviceIdIndex++]}};this.load(t)}drawImageToCanvas(t){this.canvasRef.nativeElement.getContext("2d")?.drawImage(t,0,0,this.videoRef.nativeElement.width,this.videoRef.nativeElement.height)}capture(){this.drawImageToCanvas(this.videoRef.nativeElement);const t=this.canvasRef.nativeElement.toDataURL("image/png");this.hasPhoto=!0,console.log("capture: ",`${t.substring(0,50)}...`),console.log("capture blob: ",":("),this.imgRef.nativeElement.src=t}unCapture(){this.hasPhoto=!1}}g.\u0275fac=function(t){return new(t||g)(e.Y36(f.ux),e.Y36(E.D))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-photo-dialog"]],viewQuery:function(t,n){if(1&t&&(e.Gf(w,7),e.Gf(I,7),e.Gf(O,7)),2&t){let i;e.iGM(i=e.CRH())&&(n.videoRef=i.first),e.iGM(i=e.CRH())&&(n.canvasRef=i.first),e.iGM(i=e.CRH())&&(n.imgRef=i.first)}},decls:16,vars:15,consts:[[4,"ngIf"],["mat-raised-button","","mat-dialog-close",""],["autoplay","","playsinline","",3,"appDimensionVideo"],["video",""],["aria-hidden","true","alt","",3,"appDimensionVideo"],["img",""],[3,"appDimensionCanvas","isLoaded"],["canvas",""],["align","end"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"mat-dialog-content"),e._UZ(1,"app-loader"),e.YNc(2,L,3,0,"ng-container",0),e.YNc(3,Z,3,0,"ng-container",0),e.TgZ(4,"button",1),e._uU(5,"cancel"),e.qZA(),e._UZ(6,"video",2,3)(8,"img",4,5)(10,"canvas",6,7),e.qZA(),e.TgZ(12,"mat-dialog-actions",8),e.YNc(13,k,3,0,"ng-container",0),e.YNc(14,B,5,0,"ng-container",0),e.YNc(15,A,3,0,"ng-container",0),e.qZA()),2&t){const i=e.MAs(7);e.xp6(2),e.Q6J("ngIf",!n.isLoaded),e.xp6(1),e.Q6J("ngIf",n.isLoaded),e.xp6(3),e.ekj("show",n.hasPhoto),e.Q6J("appDimensionVideo",n.isLoaded),e.xp6(2),e.ekj("hide",!n.hasPhoto),e.Q6J("appDimensionVideo",n.isLoaded),e.xp6(2),e.ekj("hide",!0),e.Q6J("appDimensionCanvas",i)("isLoaded",n.isLoaded),e.xp6(3),e.Q6J("ngIf",!n.hasPhoto),e.xp6(1),e.Q6J("ngIf",!n.hasPhoto),e.xp6(1),e.Q6J("ngIf",n.hasPhoto)}},dependencies:[v.O5,r.ZT,r.xY,r.H8,u.lW,y.Hw,S.R,h,m],styles:["[_nghost-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100vw;height:100vh;max-height:100vh}[_nghost-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:1}[_nghost-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]   button[mat-raised-button][_ngcontent-%COMP%]{position:absolute;top:10px;right:102px}[_nghost-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]   button[mat-raised-button][mat-dialog-close][_ngcontent-%COMP%]{top:10px;right:10px}[_nghost-%COMP%]   mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;flex-wrap:wrap;flex-direction:row;align-items:center;position:fixed;background:rgba(0,0,0,.4);bottom:0;padding:16px 20px;width:100%}.show[_ngcontent-%COMP%]{display:block}.hide[_ngcontent-%COMP%]{display:none}"]});class p{constructor(t,n){this.dialog=t,this.snackBar=n}ngOnInit(){this.openDialog()}openDialog(){this.dialog.open(g,{height:"100vh",width:"100vw",maxWidth:"100vw"}).afterClosed().subscribe(t=>{console.log("result: ",t),t&&this.snackBar.open("salvo","",{duration:2e3})})}}p.\u0275fac=function(t){return new(t||p)(e.Y36(r.uw),e.Y36(f.ux))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-photo"]],decls:2,vars:0,consts:[["mat-raised-button","","color","primary",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.openDialog()}),e._uU(1,"open camera"),e.qZA())},dependencies:[u.lW],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}"]});const J=[{path:"",component:p}];class d{}d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[P.Bz.forChild(J),P.Bz]});class l{}l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[v.ez,d,u.ot,f.ZX,r.Is,c]})}}]);